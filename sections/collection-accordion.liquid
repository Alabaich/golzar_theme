<style>
  #accordion-{{ section.id }} .accordion-item {
    border-bottom: 1px solid #e0e0e0;
  }

  #accordion-{{ section.id }} .accordion-item:first-child {
    border-top: 1px solid #e0e0e0;
  }

  #accordion-{{ section.id }} .accordion-header {
    width: 100%;
    padding: 25px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: none;
    border: none;
    cursor: pointer;
    text-align: left;
  }

  #accordion-{{ section.id }} .accordion-title {
    font-weight: 600;
    margin: 0;
    color: #000;
    letter-spacing: -0.02em;
  }

  #accordion-{{ section.id }} .accordion-icon {
    width: 16px;
    height: 16px;
    transition: transform 0.3s ease;
  }

  #accordion-{{ section.id }} .accordion-header.active .accordion-icon {
    transform: rotate(180deg);
  }

  #accordion-{{ section.id }} .accordion-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s ease, opacity 0.4s ease;
    opacity: 0;
  }

  #accordion-{{ section.id }} .accordion-content.open {
    opacity: 1;
  }

  #accordion-{{ section.id }} .slider-wrapper {
    position: relative;
    padding: 40px 0 50px;
  }

  #accordion-{{ section.id }} .view-all-container {
    position: absolute;
    top: 0;
    right: 0;
    z-index: 5;
  }

  #accordion-{{ section.id }} .view-all-link {
    font-size: 1.6rem;
    font-weight: 500;
    color: #333;
    text-decoration: underline;
    text-underline-offset: 4px;
    transition: opacity 0.2s ease;
  }

  #accordion-{{ section.id }} .view-all-link:hover {
    opacity: 0.7;
    color: #000;
  }

  #accordion-{{ section.id }} .slider-container {
    display: flex;
    gap: 25px;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    scroll-behavior: smooth;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  #accordion-{{ section.id }} .slider-container::-webkit-scrollbar {
    display: none;
  }

  #accordion-{{ section.id }} .slider-arrow {
    position: absolute;
    top: 55%;
    transform: translateY(-50%);
    z-index: 10;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: #ffffff;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    border: 1px solid #f0f0f0;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    color: #333;
    opacity: 0;
    pointer-events: none;
  }

  #accordion-{{ section.id }} .accordion-content.open .slider-arrow {
    opacity: 1;
    pointer-events: auto;
  }

  #accordion-{{ section.id }} .slider-arrow:hover {
    background-color: #000;
    color: #fff;
    border-color: #000;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  #accordion-{{ section.id }} .slider-arrow--prev {
    left: 10px;
  }

  #accordion-{{ section.id }} .slider-arrow--next {
    right: 10px;
  }

  #accordion-{{ section.id }} .slider-arrow svg {
    width: 18px;
    height: 18px;
  }

  #accordion-{{ section.id }} .slider-product-card {
    flex: 0 0 280px;
    scroll-snap-align: start;
    display: flex;
    flex-direction: column;
    text-decoration: none;
    color: inherit;
    background: #fff;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  #accordion-{{ section.id }} .slider-product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
  }

  #accordion-{{ section.id }} .slider-img-wrapper {
    width: 100%;
    aspect-ratio: 1 / 1;
    overflow: hidden;
    background-color: #f8f8f8;
    position: relative;
  }

  #accordion-{{ section.id }} .slider-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }

  #accordion-{{ section.id }} .slider-product-card:hover .slider-img {
    transform: scale(1.05);
  }

  #accordion-{{ section.id }} .slider-info {
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    flex-grow: 1;
  }

  #accordion-{{ section.id }} .slider-title {
    font-weight: 500;
    margin: 0;
    line-height: 1.3;
    font-size: 1.25em;
    overflow: hidden;
  }

  #accordion-{{ section.id }} .slider-vendor {
    font-size: 0.95rem;
    color: #777;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  #accordion-{{ section.id }} .slider-price {
    font-size: 1.75rem;
    font-weight: 600;
    margin-top: 5px;
  }

  #accordion-{{ section.id }} .slider-price s {
    color: #aaa;
    font-size: 1.25rem;
    font-weight: 400;
    margin-left: 8px;
  }

  @media (max-width: 768px) {
    #accordion-{{ section.id }} .slider-product-card {
      flex: 0 0 240px;
    }
    #accordion-{{ section.id }} .slider-arrow {
      display: none;
    }
    #accordion-{{ section.id }} .slider-wrapper {
      padding: 30px 0;
    }
    #accordion-{{ section.id }} .slider-container {
      padding: 0 15px;
    }
    #accordion-{{ section.id }} .view-all-container {
      right: 15px;
    }
  }
</style>

<div class="accordion-section pageWidth page-width" id="accordion-{{ section.id }}">
  <div class="accordion-wrapper">
    {% for block in section.blocks %}
      <div class="accordion-item" {{ block.shopify_attributes }}>
        <button class="accordion-header">
          <h3 class="accordion-title">{{ block.settings.heading | escape }}</h3>
          <svg class="accordion-icon" viewBox="0 0 14 9" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1 1L7 7L13 1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>

        <div class="accordion-content">
          <div class="slider-wrapper">
            
            {% assign collection = collections[block.settings.collection] %}
            
            {% if collection != blank %}
              <div class="view-all-container">
                <a href="{{ collection.url }}" class="view-all-link">View Collection</a>
              </div>
            {% endif %}

            <button class="slider-arrow slider-arrow--prev" aria-label="Previous slide">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
              </svg>
            </button>
            <button class="slider-arrow slider-arrow--next" aria-label="Next slide">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
              </svg>
            </button>

            <div class="slider-container">
              {% if collection != blank and collection.products_count > 0 %}
                {% for product in collection.products limit: block.settings.limit %}
                  <a href="{{ product.url }}" class="slider-product-card">
                    <div class="slider-img-wrapper">
                      {% if product.featured_image %}
                        {{ product.featured_image | image_url: width: 600 | image_tag: loading: 'lazy', class: 'slider-img' }}
                      {% else %}
                        {{ 'product-1' | placeholder_svg_tag: 'slider-img' }}
                      {% endif %}
                    </div>
                    <div class="slider-info">
                      {% if section.settings.show_vendor %}
                        <span class="slider-vendor">{{ product.vendor }}</span>
                      {% endif %}
                      <h4 class="slider-title">{{ product.title }}</h4>
                      <div class="slider-price">
                        {% if product.compare_at_price > product.price %}
                          <span style="color: #d9534f;">{{ product.price | money }}</span>
                          <s>{{ product.compare_at_price | money }}</s>
                        {% else %}
                          <span>{{ product.price | money }}</span>
                        {% endif %}
                      </div>
                    </div>
                  </a>
                {% endfor %}
              {% else %}
                {% for i in (1..6) %}
                  <div class="slider-product-card">
                    <div class="slider-img-wrapper">
                      {{ 'product-' | append: i | placeholder_svg_tag: 'slider-img' }}
                    </div>
                    <div class="slider-info">
                      <span class="slider-vendor">Brand Demo</span>
                      <h4 class="slider-title">Example Product Title {{ i }}</h4>
                      <div class="slider-price">$99.00</div>
                    </div>
                  </div>
                {% endfor %}
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    
    const headers = document.querySelectorAll('#accordion-{{ section.id }} .accordion-header');
    headers.forEach(header => {
      header.addEventListener('click', function() {
        const content = this.nextElementSibling;
        const isOpen = this.classList.contains('active');

        headers.forEach(h => {
          if (h !== this) {
            h.classList.remove('active');
            h.nextElementSibling.style.maxHeight = null;
            h.nextElementSibling.classList.remove('open');
          }
        });

        this.classList.toggle('active');
        
        if (!isOpen) {
          content.classList.add('open');
          content.style.maxHeight = content.scrollHeight + 100 + "px";
        } else {
          content.classList.remove('open');
          content.style.maxHeight = null;
        }
      });
    });

    const accordionItems = document.querySelectorAll('#accordion-{{ section.id }} .accordion-item');

    accordionItems.forEach(item => {
        const container = item.querySelector('.slider-container');
        const prevBtn = item.querySelector('.slider-arrow--prev');
        const nextBtn = item.querySelector('.slider-arrow--next');

        if (!container || !prevBtn || !nextBtn) return;

        const scrollAmount = 305; 

        prevBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            container.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
        });

        nextBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            container.scrollBy({ left: scrollAmount, behavior: 'smooth' });
        });
    });
  });
</script>

{% schema %}
{
  "name": "Collection Accordion Pro",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show Vendor",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "collection_block",
      "name": "Collection Row",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "New Arrivals"
        },
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        },
        {
          "type": "range",
          "id": "limit",
          "min": 4,
          "max": 24,
          "step": 1,
          "label": "Product Limit",
          "default": 12
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Collection Accordion Pro",
      "blocks": [
        {
          "type": "collection_block",
          "settings": {
            "heading": "New Arrivals"
          }
        },
        {
          "type": "collection_block",
          "settings": {
            "heading": "Best Sellers"
          }
        }
      ]
    }
  ]
}
{% endschema %}