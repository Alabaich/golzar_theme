{%- liquid
  assign settings = section.settings
  assign section_title = settings.section_title
-%}

{%- style -%}
  .ig-section-{{ section.id }} {
    --section-padding-top: {{ settings.padding_top | default: 50 }}px;
    --section-padding-bottom: {{ settings.padding_bottom | default: 50 }}px;
    --title-color: {{ settings.title_color | default: '#101828' }};
    --title-font-size-desktop: {{ settings.title_font_size_desktop | default: 32 }}px;
    --title-font-size-mobile: {{ settings.title_font_size_mobile | default: 24 }}px;
    --gap-size: {{ settings.gap_size | default: 16 }}px;

    background-color: {{ settings.background_color | default: 'transparent' }};
    padding-top: var(--section-padding-top);
    padding-bottom: var(--section-padding-bottom);
    font-family: 'Raleway'
    , sans-serif;
  }

  .ig-section-{{ section.id }}
  .ig__title {
    font-family: 'Raleway'
    , sans-serif;
    font-weight: 600;
    font-size: var(--title-font-size-desktop);
    line-height: 1.3;
    color: var(--title-color);
    margin-top: 0;
    margin-bottom: 30px;
    text-align: {{ settings.title_align | default: 'left' }};
  }

  .ig-section-{{ section.id }}
  .ig__grid-container {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    /* 4 колонки, как в вашем примере */
    grid-template-rows: repeat(2, 1fr);
    /* 2 строки, как в вашем примере */
    /* Вместо grid-column-gap и grid-row-gap используем общую переменную gap */
    gap: var(--gap-size);
  }

  /* Применяем grid-area к каждому слоту */
  .ig-section-{{ section.id }} .ig__slot--1 {
    grid-area: 1 / 1 / 2 / 3;
  }
  .ig-section-{{ section.id }}
  .ig__slot--2 {
    grid-area: 2 / 1 / 3 / 2;
  }
  .ig-section-{{ section.id }}
  .ig__slot--3 {
    grid-area: 2 / 2 / 3 / 3;
  }
  .ig-section-{{ section.id }}
  .ig__slot--4 {
    grid-area: 1 / 3 / 2 / 4;
  }
  .ig-section-{{ section.id }}
  .ig__slot--5 {
    grid-area: 1 / 4 / 2 / 5;
  }
  .ig-section-{{ section.id }}
  .ig__slot--6 {
    grid-area: 2 / 3 / 3 / 5;
  }

  .ig-section-{{ section.id }}
  .ig__slot {
    position: relative;
    overflow: hidden;
    border-radius: 16px;
    background-color: #f0f0f0;
    transition: transform 0.3s ease;
    aspect-ratio: {{ settings.image_aspect_ratio | default: '3/4' }};


    /*

   height: 100%; и width: 100%; для дочерних элементов grid-area обычно не нужны, 
   но полезны для содержимого внутри, если оно не изображение 
*/
  }

  /* Исправленный селектор hover */
  .ig-section-{{ section.id }}.ig__slot:hover {
    transform: scale(0.98);
  }

  .ig-section-{{ section.id }}
  .ig__slot img
  , .ig-section-{{ section.id }}
  .ig__slot .ig__placeholder-svg-wrapper {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .ig-section-{{ section.id }}
  .ig__slot .ig__placeholder-svg-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #f5f5f5;
  }

  .ig-section-{{ section.id }}
  .ig__slot .placeholder-svg {
    width: 25%;
    /* Можно настроить */
    height: 25%;
    /* Можно настроить */
    max-width: 80px;
    max-height: 80px;
    opacity: 0.2;
  }

  @media (max-width: 768px) {
    .ig-section-{{ section.id }} .ig__title {
      font-size: var(--title-font-size-mobile);
      margin-bottom: 20px;
    }

    .ig-section-{{ section.id }}
    .ig__grid-container {
      grid-template-columns: 1fr 1fr;
      /* Например, 2 колонки на мобильных */
      grid-template-rows: auto;
      /* Автоматическая высота строк */
      /* Сброс grid-area, так как элементы будут идти по порядку */
    }
    .ig-section-{{ section.id }}
    .ig__slot--1
    , .ig-section-{{ section.id }}
    .ig__slot--2
    , .ig-section-{{ section.id }}
    .ig__slot--3
    , .ig-section-{{ section.id }}
    .ig__slot--4
    , .ig-section-{{ section.id }}
    .ig__slot--5
    , .ig-section-{{ section.id }}
    .ig__slot--6 {
      grid-area: auto / auto / auto / auto;
      /* Сброс grid-area */
    }


    /*

   Если хотите 1 колонку на мобильных, используйте: 
   .ig-section-{{ section.id }} .ig__grid-container { 
   grid-template-columns: 1fr; 
   grid-template-rows: auto; 
   } 
*/

    .ig-section-{{ section.id }} .ig__slot {
      aspect-ratio: {{ settings.mobile_image_aspect_ratio | default: '1/1' }};
      /* Можно сделать отдельную настройку для мобильных */
    }
  }
{%- endstyle -%}

<div class="ig-section-{{ section.id }}">
  <div class="page-width">
    {%- if section_title != blank -%}
      <h2 class="ig__title">{{ section_title | escape }}</h2>
    {%- endif -%}

    <div class="ig__grid-container">
      {%- for i in (1..6) -%}
        {%- capture slot_image_setting -%}image_slot_{{ i }}{%- endcapture -%}
        {%- capture slot_link_setting -%}link_slot_{{ i }}{%- endcapture -%}
        {%- capture slot_alt_setting -%}alt_slot_{{ i }}{%- endcapture -%}

        {%- assign image = settings[slot_image_setting] -%}
        {%- assign link = settings[slot_link_setting] -%}
        {%- assign alt_text = settings[slot_alt_setting] -%}

      {%- assign slot_class = "ig__slot ig__slot--" | append: i -%}

        {%- comment -%} Определяем sizes для каждого слота на десктопе (4 колонки в сетке) {%- endcomment -%}
        {%- assign desktop_size = "25vw" -%} {# По умолчанию для ячейки 1x1 #}
        {%- if i == 1 or i == 6 -%}
          {%- assign desktop_size = "50vw" -%} {# Слоты 1 и 6 занимают 2 колонки из 4 #}
      {%- endif -%}

        {%- comment -%} Определяем sizes для мобильных (предполагаем 2 колонки) {%- endcomment -%}
        {%- assign mobile_size = "50vw" -%}
        {%- comment -%} Если на мобильных 1 колонка, то mobile_size = "100vw" {%- endcomment -%}


        <div class="{{ slot_class }}">
          {%- if image != blank -%}
            {%- if link != blank -%}<a href="{{ link }}" aria-label="{{ alt_text | default: image.alt | default: section_title | escape }}">{%- endif -%}
            <img
              srcset="{%- if image.width >= 375 -%}{{ image | image_url: width: 375 }} 375w,{%- endif -%}
                      {%- if image.width >= 550 -%}{{ image | image_url: width: 550 }} 550w,{%- endif -%}
                      {%- if image.width >= 750 -%}{{ image | image_url: width: 750 }} 750w,{%- endif -%}
                      {%- if image.width >= 1100 -%}{{ image | image_url: width: 1100 }} 1100w,{%- endif -%}
                      {%- if image.width >= 1500 -%}{{ image | image_url: width: 1500 }} 1500w,{%- endif -%}
                      {%- if image.width >= 1780 -%}{{ image | image_url: width: 1780 }} 1780w,{%- endif -%}
                      {%- if image.width >= 2000 -%}{{ image | image_url: width: 2000 }} 2000w,{%- endif -%}
                      {%- if image.width >= 2800 -%}{{ image | image_url: width: 2800 }} 2800w,{%- endif -%}
                      {%- if image.width >= 3840 -%}{{ image | image_url: width: 3840 }} 3840w,{%- endif -%}
                      {{ image | image_url }} {{ image.width }}w"
              src="{{ image | image_url: width: 1500 }}"
              sizes="(max-width: 768px) {{ mobile_size }}, {{ desktop_size }}"
              alt="{{ alt_text | default: image.alt | default: section_title | escape }}"
              loading="lazy"
              width="{{ image.width }}"
              height="{{ image.height }}">
            {%- if link != blank -%}</a>{%- endif -%}
          {%- elsif settings.show_onboarding_placeholders -%}
            <div class="ig__placeholder-svg-wrapper">
              {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
            </div>
          {%- endif -%}
        </div>
      {%- endfor -%}
    </div>
  </div>
</div>

{% schema %}
  {
    "name": "Image Gallery Grid (6)",
    "tag": "section",
    "class": "shopify-section--image-gallery-grid",
    "settings": [
      {
        "type": "header",
        "content": "Section Title & Style"
      },
      {
        "type": "text",
        "id": "section_title",
        "label": "Title",
        "default": "Discover products in a real-life setting"
      },
      {
        "type": "select",
        "id": "title_align",
        "label": "Title Alignment",
        "options": [
          {
            "value": "left",
            "label": "Left"
          }, {
            "value": "center",
            "label": "Center"
          }, {
            "value": "right",
            "label": "Right"
          }
        ],
        "default": "left"
      },
      {
        "type": "color",
        "id": "title_color",
        "label": "Title Color",
        "default": "#101828"
      }, {
        "type": "range",
        "id": "title_font_size_desktop",
        "label": "Title Font Size (Desktop)",
        "min": 20,
        "max": 60,
        "step": 1,
        "unit": "px",
        "default": 32
      }, {
        "type": "range",
        "id": "title_font_size_mobile",
        "label": "Title Font Size (Mobile)",
        "min": 16,
        "max": 40,
        "step": 1,
        "unit": "px",
        "default": 24
      }, {
        "type": "color",
        "id": "background_color",
        "label": "Section Background Color",
        "default": "rgba(0,0,0,0)"
      }, {
        "type": "range",
        "id": "gap_size",
        "label": "Gap between images",
        "min": 0,
        "max": 30,
        "step": 1,
        "unit": "px",
        "default": 16
      }, {
        "type": "select",
        "id": "image_aspect_ratio",
        "label": "Image Aspect Ratio (Desktop)",
        "options": [
          {
            "value": "auto",
            "label": "Original (Auto)"
          },
          {
            "value": "1/1",
            "label": "Square (1:1)"
          },
          {
            "value": "2/3",
            "label": "Portrait (2:3)"
          },
          {
            "value": "3/4",
            "label": "Portrait (3:4)"
          }, {
            "value": "4/3",
            "label": "Landscape (4:3)"
          }, {
            "value": "3/2",
            "label": "Landscape (3:2)"
          }, {
            "value": "16/9",
            "label": "Wide (16:9)"
          }
        ],
        "default": "3/4",
        "info": "Applies to all image slots on desktop. 'Auto' may cause uneven row heights if 'Grid Template Rows' are not '1fr'."
      }, {
        "type": "select",
        "id": "mobile_image_aspect_ratio",
        "label": "Image Aspect Ratio (Mobile)",
        "options": [
          {
            "value": "auto",
            "label": "Original (Auto)"
          }, {
            "value": "1/1",
            "label": "Square (1:1)"
          }, {
            "value": "3/4",
            "label": "Portrait (3:4)"
          }, {
            "value": "4/3",
            "label": "Landscape (4:3)"
          }
        ],
        "default": "1/1",
        "info": "Applies to all image slots on mobile."
      }, {
        "type": "checkbox",
        "id": "show_onboarding_placeholders",
        "label": "Show placeholders for empty slots",
        "default": true
      }, {
        "type": "header",
        "content": "Image Slots (6 Total)"
      }
    ],
    "presets": [
      {
        "name": "Image Gallery Grid (6)",
        "settings": {
          "section_title": "Our Awesome Grid Gallery"
        }
      }
    ]
  }

  {%- for i in (1..6) -%}
    {%- capture header_content -%}
      Slot {{ i }} {%- endcapture -%} {%- capture image_id -%} image_slot_ {{ i }} {%- endcapture -%} {%- capture link_id -%} link_slot_ {{ i }} {%- endcapture -%} {%- capture alt_id -%} alt_slot_ {{ i }} {%- endcapture -%} {{ {
      "type": "header",
      "content": header_content
    } | json | replace: '{', '' | replace: '}', '' }},
      {{ {
      "type": "image_picker",
      "id": image_id,
      "label": "Image"
    } | json | replace: '{', '' | replace: '}', '' }},
      {{ {
      "type": "url",
      "id": link_id,
      "label": "Link (Optional)"
    } | json | replace: '{', '' | replace: '}', '' }},
      {{ {
      "type": "text",
      "id": alt_id,
      "label": "Alt Text (Optional)",
      "info": "Defaults to image name or section title."
    } | json | replace: '{', '' | replace: '}', '' }}{% unless forloop.last %},{% endunless %}
    {%- endfor -%}
{% endschema %}