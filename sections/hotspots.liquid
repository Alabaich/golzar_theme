<style>
  .shoppable-container {
    display: flex;
    flex-direction: column;
    gap: 30px;
  }

  @media (min-width: 768px) {
    .shoppable-container {
      flex-direction: row;
      align-items: flex-start;
    }
  }

  .shoppable-image-wrapper {
    position: relative;
    flex: 2;
    border-radius: 8px;
    overflow: hidden;
    line-height: 0;
    max-height: 750px; 
    width: 100%;
    background-color: #f4f4f4;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .shoppable-main-img {
    width: 100%;
    height: 100%; 
    display: block;
    object-fit: contain; 
  }

  .hotspot-dot {
    position: absolute;
    width: 24px;
    height: 24px;
    background-color: #002642;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 0 0 4px rgba(0, 38, 66, 0.3);
    transform: translate(-50%, -50%);
    transition: transform 0.3s ease, background-color 0.3s ease, box-shadow 0.3s ease;
    z-index: 2;
    border: 2px solid #ffffff; 
    padding: 0;
  }

  .hotspot-dot:hover,
  .hotspot-dot.active {
    transform: translate(-50%, -50%) scale(0.8);
    background-color: #ffffff;
    border-color: #002642;
    box-shadow: 0 0 0 6px rgba(255, 255, 255, 0.5);
  }

  .shoppable-products-wrapper {
    flex: 1;
    min-width: 300px;
    max-width: 400px;
    position: relative;
  }

  .product-detail-card-wrapper {
    display: none;
    animation: fadeIn 0.4s ease;
  }

  .product-detail-card-wrapper.active {
    display: block;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(5px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .shoppable-section .grid-item.product-card {
    width: 100%;
    border: 1px solid #e0e0e0;
    border-radius: 12px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    background: #fff;
  }

  .shoppable-section .product-card__link-image {
    text-decoration: none;
    color: inherit;
    display: block;
    position: relative;
  }

  .shoppable-section .product-card__image-wrapper {
    padding: 0;
    background-color: #f9f9f9;
    position: relative;
    overflow: hidden;
  }

  .shoppable-section .product-card__image {
    display: block;
    width: 100%;
    height: auto;
    aspect-ratio: 3 / 3;
    object-fit: cover;
    transition: opacity 0.3s ease;
  }

  .shoppable-section .product-card__image-hover {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    transition: opacity 0.3s ease;
    object-fit: cover;
  }

  .shoppable-section .product-card.has-second-image:hover .product-card__image-hover {
    opacity: 1;
  }

  .shoppable-section .product-card.has-second-image:hover .product-card__image:not(.product-card__image-hover) {
    opacity: 0;
  }

  .shoppable-section .product-card__badge-info {
    position: absolute;
    top: 10px;
    left: 10px;
    display: flex;
    flex-direction: column;
    gap: 5px;
    z-index: 1;
  }

  .shoppable-section .badge {
    padding: 3px 8px;
    font-size: 0.8em;
    border-radius: 3px;
    color: #fff;
  }

  .shoppable-section .badge--vendor {
    background-color: #555;
  }

  .shoppable-section .badge--discount {
    background-color: #d9534f;
  }

  .shoppable-section .product-card__info {
    padding: 15px;
    text-align: left;
    display: flex;
    flex-direction: column;
    flex-grow: 1;
  }

  .shoppable-section .product-card__availability {
    font-size: 0.85em;
    margin: 0;
    padding-bottom: 5px;
  }

  .shoppable-section .product-card__availability--in-stock {
    color: #28a745;
  }

  .shoppable-section .product-card__availability--out-of-stock {
    color: #dc3545;
  }

  .shoppable-section .product-card__title-link {
    text-decoration: none;
    color: inherit;
  }

  .shoppable-section .product-card__title {
    font-weight: bold;
    margin-top: 0;
    margin-bottom: 1rem;
    font-size: 1em;
  }

  .shoppable-section .product-card__price-wrapper {
    margin-bottom: 1rem !important;
    font-size: 0.9em;
  }

  .shoppable-section .product-card__price-wrapper .price--sale {
    color: #D9534F;
    font-size: 18px;
    font-weight: bold;
  }

  .shoppable-section .product-card__price-wrapper .price--original {
    color: #777777;
    text-decoration: line-through;
    margin-left: 8px;
    font-size: 0.9em;
  }

  .shoppable-section .product-card__form-container {
    display: flex;
    gap: 10px;
    margin-top: auto;
    align-items: center;
  }

  .shoppable-section .product-card__form {
    flex-grow: 1;
  }

  .shoppable-section .collection-grid-item__add-to-cart-button {
    display: flex;
    width: 100%;
    justify-content: center;
    padding: 12px 15px;
    background-color: #002642;
    color: #ffffff;
    border: 2px solid #002642;
    border-radius: 50px;
    font-size: 0.9em;
    font-weight: 300;
    cursor: pointer;
    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
    text-align: center;
  }

  .shoppable-section .collection-grid-item__add-to-cart-button:hover:not(:disabled) {
    background-color: #003366;
    border-color: #003366;
    color: #ffffff;
  }

  .shoppable-section .collection-grid-item__add-to-cart-button.button--disabled {
    background-color: #ebebeb;
    color: #555555;
    border: 2px solid #d0d0d0;
    cursor: not-allowed;
    opacity: 1;
  }
</style>

<div class="shoppable-section pageWidth page-width">
  <div class="shoppable-container">

    <div class="shoppable-image-wrapper">
      {% if section.settings.image != blank %}
        <img
          src="{{ section.settings.image | img_url: 'master' }}"
          alt="{{ section.settings.image.alt }}"
          class="shoppable-main-img">
      {% else %}
        {{ 'lifestyle-1' | placeholder_svg_tag: 'shoppable-main-img' }}
      {% endif %}

      {% for block in section.blocks %}
        {% if block.settings.product != blank %}
          <button
            class="hotspot-dot {% if forloop.first %}active{% endif %}"
            style="top: {{ block.settings.pos_y }}%; left: {{ block.settings.pos_x }}%;"
            data-target="product-{{ block.id }}"
            aria-label="View product"></button>
        {% endif %}
      {% endfor %}
    </div>

    <div class="shoppable-products-wrapper">
      {% for block in section.blocks %}
        {% assign product = all_products[block.settings.product] %}

        {% if product != blank %}
          {%- liquid
            assign current_variant = product.selected_or_first_available_variant
            assign discount_percentage = 0
            if current_variant.compare_at_price > current_variant.price
              assign discount_amount = current_variant.compare_at_price | minus: current_variant.price
              assign discount_percentage = discount_amount | times: 100.0 | divided_by: current_variant.compare_at_price | round
            endif
            assign has_second_image = false
            if product.images.size > 1
              assign has_second_image = true
            endif
          -%}

          <div id="product-{{ block.id }}" class="product-detail-card-wrapper {% if forloop.first %}active{% endif %}">
            <div class="grid-item product-card{% if discount_percentage > 0 %} product-card--on-sale{% endif %}{% if has_second_image %} has-second-image{% endif %}">
              <a
                href="{{ product.url }}"
                class="product-card__link-image"
                title="{{ product.vendor | escape }}">
                <div class="product-card__image-wrapper">
                  {% if product.featured_image %}
                    {{ product.featured_image | image_url: width: 500 | image_tag: loading: 'lazy', widths: '200, 300, 400, 500', class: 'product-card__image' }}
                    {% if has_second_image %}
                      {{ product.images[1] | image_url: width: 500 | image_tag: loading: 'lazy', widths: '200, 300, 400, 500', class: 'product-card__image-hover' }}
                    {% endif %}
                  {% else %}
                    {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg product-card__image' }}
                  {% endif %}

                  <div class="product-card__badge-info">
                    {% if section.settings.show_vendor %}
                      <span class="badge badge--vendor" title="{{ product.vendor | escape }}">{{ product.vendor | escape }}</span>
                    {% endif %}
                    {% if discount_percentage > 0 and section.settings.show_discount_badge %}
                      <span class="badge badge--discount">-{{ discount_percentage }}%</span>
                    {% endif %}
                  </div>
                </div>
              </a>

              <div class="product-card__info">
                {% if section.settings.show_availability %}
                  {% if current_variant.available %}
                    <p class="product-card__availability product-card__availability--in-stock">In Stock</p>
                  {% else %}
                    <p class="product-card__availability product-card__availability--out-of-stock">Sold Out</p>
                  {% endif %}
                {% endif %}

                <a href="{{ product.url }}" class="product-card__title-link">
                  <h3 class="product-card__title">{{ product.title | truncate: 30 | escape }}</h3>
                </a>

                <div class="product-card__price-wrapper">
                  {%- if current_variant.compare_at_price > current_variant.price -%}
                    <span class="price--sale">{{ current_variant.price | money }}</span>
                    <s class="price--original">{{ current_variant.compare_at_price | money }}</s>
                  {%- else -%}
                    <span class="price--regular">{{ current_variant.price | money }}</span>
                  {%- endif -%}
                </div>

                {% if section.settings.show_add_to_cart_button %}
                  <div class="product-card__form-container">
                    <form
                      action="{{ routes.cart_add_url }}"
                      method="post"
                      enctype="multipart/form-data"
                      class="product-card__form">
                      <input
                        type="hidden"
                        name="id"
                        value="{{ current_variant.id }}">
                      <input
                        type="hidden"
                        name="quantity"
                        value="1">
                      <button
                        type="submit"
                        class="collection-grid-item__add-to-cart-button{% unless current_variant.available %} button--disabled{% endunless %}"
                        {% unless current_variant.available %}
                        disabled
                        aria-disabled="true"
                        {% endunless %}>
                        {% if current_variant.available %}
                          <span>{{ section.settings.product_button_text | escape }}</span>
                        {% else %}
                          <span>Sold Out</span>
                        {% endif %}
                      </button>
                    </form>
                  </div>
                {% endif %}
              </div>
            </div>
          </div>
        {% endif %}
      {% endfor %}
    </div>

  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const container = document.querySelector('.shoppable-container');
    if (!container) return;
  
    const dots = container.querySelectorAll('.hotspot-dot');
    const wrappers = container.querySelectorAll('.product-detail-card-wrapper');
  
    dots.forEach(dot => {
      dot.addEventListener('click', function() {
        dots.forEach(d => d.classList.remove('active'));
        wrappers.forEach(w => w.classList.remove('active'));
  
        this.classList.add('active');
        const targetId = this.getAttribute('data-target');
        const targetWrapper = document.getElementById(targetId);
        
        if (targetWrapper) {
          targetWrapper.classList.add('active');
        }
      });
    });
  });
</script>

{% schema %}
  {
    "name": "Shoppable Image",
    "settings": [
      {
        "type": "image_picker",
        "id": "image",
        "label": "Main Image"
      },
      {
        "type": "header",
        "content": "Product Card Settings"
      },
      {
        "type": "checkbox",
        "id": "show_vendor",
        "label": "Show Vendor",
        "default": false
      },
      {
        "type": "checkbox",
        "id": "show_discount_badge",
        "label": "Show Discount Badge",
        "default": true
      }, {
        "type": "checkbox",
        "id": "show_availability",
        "label": "Show Availability",
        "default": true
      }, {
        "type": "checkbox",
        "id": "show_add_to_cart_button",
        "label": "Show Add to Cart Button",
        "default": true
      }, {
        "type": "text",
        "id": "product_button_text",
        "label": "Button Text",
        "default": "Buy now"
      }
    ],
    "blocks": [
      {
        "type": "hotspot",
        "name": "Product Hotspot",
        "settings": [
          {
            "type": "product",
            "id": "product",
            "label": "Select Product"
          }, {
            "type": "range",
            "id": "pos_x",
            "min": 0,
            "max": 100,
            "step": 1,
            "unit": "%",
            "label": "Horizontal Position",
            "default": 50
          }, {
            "type": "range",
            "id": "pos_y",
            "min": 0,
            "max": 100,
            "step": 1,
            "unit": "%",
            "label": "Vertical Position",
            "default": 50
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Shoppable Image",
        "blocks": [
          {
            "type": "hotspot",
            "settings": {
              "pos_x": 30,
              "pos_y": 40
            }
          }
        ]
      }
    ]
  }
{% endschema %}